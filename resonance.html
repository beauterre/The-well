<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Koepel Resonator Visualisatie</title>
<style>
  body { font-family: sans-serif; text-align: center; margin: 20px; }
  canvas { border: 1px solid #000; margin-top: 20px; }
  input { margin: 5px; }
</style>
</head>
<body>

<h2>Geodetische Koepel Resonator - Геодезичен купол резонатор</h2>
<button onclick="playTone()">Speel toon - Пусни тона</button>

  <img src="resonance.html">
<label>Straal r (m) - Радиус r (m): <input type="number" id="radiusInput" value="5.88" step="0.01"></label><br>
<label>MIDI noot (0-127) -MIDI нота (0–127): <input type="number" id="midiInput" value="21" min="0" max="127"></label><br>
<span id="noteName">Note: A0</span><br>

<canvas id="canvas" width="600" height="200"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const radiusInput = document.getElementById('radiusInput');
const midiInput = document.getElementById('midiInput');
const noteNameSpan = document.getElementById('noteName');

const c = 343; // geluidssnelheid m/s

// MIDI nummer naar frequentie
function midiToFreq(midi) {
  return 440 * Math.pow(2, (midi - 69)/12);
}

// MIDI nummer naar naam
function midiToName(midi) {
  const names = ['C','C♯','D','D♯','E','F','F♯','G','G♯','A','A♯','B'];
  const n = midi % 12;
  const octave = Math.floor(midi / 12) - 1;
  return names[n] + octave;
}

// Canvas update
function updateCanvas() {
  const r = parseFloat(radiusInput.value);
  const diameter = 2*r;
  const midi = parseInt(midiInput.value);
  const f = midiToFreq(midi);
  const lambda = c / f; // golflengte
  const halfLambda = lambda / 2;

  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = '#eee';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Diameter lijn
  ctx.strokeStyle = 'blue';
  ctx.lineWidth = 4;
  ctx.beginPath();
  ctx.moveTo(50,100);
  ctx.lineTo(50 + canvas.width-100, 100);
  ctx.stroke();
  ctx.fillStyle = 'blue';
  ctx.fillText(`Diameter = ${diameter.toFixed(2)} m`, 200, 90);

  // Halve golflengte lijn
  const scale = (canvas.width-100)/diameter; // pixels per meter
  ctx.strokeStyle = 'red';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(50,150);
  ctx.lineTo(50 + halfLambda*scale,150);
  ctx.stroke();
  ctx.fillStyle = 'red';
  ctx.fillText(`Halve golflengte = ${halfLambda.toFixed(2)} m`, 200, 170);

  // Update note name
  noteNameSpan.textContent = `Note - Нота: ${midiToName(midi)} (${f.toFixed(2)} Hz)`;
}

// WebAudio speeltoon
function playTone() {
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const oscillator = audioCtx.createOscillator();
  const midi = parseInt(midiInput.value);
  oscillator.frequency.value = midiToFreq(midi);
  oscillator.type = 'sine';
  oscillator.connect(audioCtx.destination);
  oscillator.start();
  oscillator.stop(audioCtx.currentTime + 1); // 1s
}

// MIDI input verandert
midiInput.addEventListener('input', () => {
  const midi = parseInt(midiInput.value);
  const f = midiToFreq(midi);
  const lambda = c / f;
  radiusInput.value = (lambda/2).toFixed(2); // Pas r aan op halve golflengte
  updateCanvas();
});

// Straal input verandert
radiusInput.addEventListener('input', updateCanvas);

updateCanvas();
</script>

</body>
</html>
